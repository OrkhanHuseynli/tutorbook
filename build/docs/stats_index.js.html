<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>stats/index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Dashboard.html">Dashboard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Dashboard.html#renderSelf">renderSelf</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Dashboard.html#reView">reView</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Dashboard.html#view">view</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Data.html">Data</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#.algoliaIndex">algoliaIndex</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#.listen">listen</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#.updateUser">updateUser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#initGrades">initGrades</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#initHourlyCharges">initHourlyCharges</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#initLocations">initLocations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#initPeriods">initPeriods</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Data.html#initTimes">initTimes</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Help.html">Help</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Help.html#logout">logout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Help.html#view">view</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Stats.html">Stats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#renderSelf">renderSelf</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#view">view</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#viewCards">viewCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#viewRecentActivityCards">viewRecentActivityCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#viewServiceHourCards">viewServiceHourCards</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Tutorbook.html">Tutorbook</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#initOnMobile">initOnMobile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#initRootConfig">initRootConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#initUser">initUser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#initWebsiteConfig">initWebsiteConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#loader">loader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#login">login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#logJobPost">logJobPost</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#preInit">preInit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#print">print</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#signOut">signOut</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#syncConfig">syncConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#updateUser">updateUser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tutorbook.html#view">view</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li>
</nav>

<div id="main">
    
    <h1 class="page-title">stats/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import $ from 'jquery';

const Utils = require('@tutorbook/utils');
const Card = require('@tutorbook/card');

class Stats {

    /**
     * Creates and renders (using the global `window.app.render` object) a new 
     * Stats object.
     */
    constructor() {
        this.render = window.app.render;
        this.renderSelf();
    }

    /**
     * Renders the statistics view/page.
     */
    renderSelf() {
        this.header = this.render.header('header-main', {
            title: 'Tutorbook',
        });
        this.main = this.render.template('stats', {
            title: window.app.location.name.split(' ')[0] + ' Statistics',
            welcome: !window.app.onMobile,
        });
    }

    /**
     * Views the statistics page (using the global `window.app.view` function).
     * @see {@link Tutorbook#view}
     */
    view() {
        window.app.nav.selected = 'Stats';
        window.app.intercom.view(true);
        window.app.view(this.header, this.main, '/app/stats');
        this.cardsViewed ? null : this.viewCards();
    }

    /**
     * Views the recent activity cards and service hour statistics card(s).
     */
    viewCards() {
        this.cardsViewed = true;
        this.viewRecentActivityCards();
        this.viewServiceHourCards();
    }

    /**
     * Views the recent activity cards from all of the current user's locations.
     */
    async viewRecentActivityCards() {
        const emptyCard = Card.renderCard(
            'You\'re Done!',
            'Hooray you\'re all caught up, for now...',
            'No recent activity at the ' + window.app.location.name + ' that ' +
            'you haven\'t already addressed. Note that (right now) we only ' +
            'show cards for new requests, canceled requests, and updated ' +
            'profiles. More updates coming soon!', {
                great: () => {
                    $(emptyCard).remove();
                },
            },
        );
        $(emptyCard).attr('id', 'empty-card');
        const renderCard = (doc, index) => {
            const action = doc.data();
            const card = Card.renderCard(
                action.title,
                action.subtitle,
                action.summary, {
                    dismiss: () => {
                        $(card).remove();
                        return doc.ref.delete();
                    },
                },
            );
            $(card).attr('id', doc.id).attr('index', index)
                .attr('timestamp', action.timestamp);
            return card;
        };
        const recycler = {
            display: (doc, type, index) => {
                $(this.main).find('#activity #cards')
                    .find('#empty-card').remove().end()
                    .append(renderCard(doc, index));
            },
            remove: (doc, type, index) => {
                $(this.main).find('#activity #cards')
                    .find('#empty-card').remove().end()
                    .find('#' + doc.id).remove().end();
            },
            empty: (type, index) => {
                $(this.main).find('#activity #cards [index="' + index + '"]')
                    .remove();
            },
        };
        const queries = {
            activity: [],
        };
        (await Data.getLocations()).forEach(location => queries.activity
            .push(window.app.db.collection('locations').doc(location.id)
                .collection('recentActions').orderBy('timestamp').limit(10)));
        Utils.recycle(queries, recycler);
    }

    /**
     * Views the service hour statistics cards.
     * @todo Actually make this do something.
     */
    viewServiceHourCards() {}
}

module.exports = Stats;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Tue Feb 25 2020 08:57:17 GMT-0800 (Pacific Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
